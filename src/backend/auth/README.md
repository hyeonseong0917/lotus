# 궁금증증

## 1 sns 이메일 중복에 대해
sns 로그인 naver, kakao, google을 구현하면서
kakao에 문제가 생겼는데
저 같은 경우는 naver계정의 아이디와 카카오 계정의 아이디가 같습니다
ex) 네이버도 abcd@naver.com 카카오도 abcd@naver.com
여기서부터 많이 꼬이기 시작했는데
우선 sns로그인의 중복아이디 검사를 없앴고,
Provider라는 컬럼을 통해 구분하고자 했습니다.
그런데 문제는 원래 토큰에 이메일에 대한 정보를 넣어서 보내주었는데
카카오때문에 구분이 안되는 바람에 이메일 말고 데이터베이스의 pk값을 담아서 보내주었습니다
그러다보니 토큰에서 유저정보를 가져오는 것도 원래 email로 가져왔는데
user_id(pk)로 바꿔오는걸로 코드를 전부 고치게 되었는데 이 과정이 비효율적이었던 것 같습니다

그래서 궁금한거는
sns가 다른데 이메일이 똑같은 저의 상황이 특별한 케이스인건지?
토큰에 db에 pk의 값을 넣어도 되는건지?
다른 sns지만 이메일이 같은 경우 구분을 어떻게 하는건지?
궁금합니다.



## 2 로그인/로그아웃 로직
로그아웃기능은 accesstoken의 blacklist를 만들어서 하고있는데
대부분의 블로그에서 accesstoken을 redis에 저장할때
해당 유저의 refreshtoken을 삭제해준다
그러면 로그아웃->로그인 할때마다 항상 refreshtoken이 발급되는데
원래 refreshtoken은 accesstoken을 재발급할때 사용하는걸로
최초로그인시만 발급하고 안발급해주는걸로 생각을했는데
그러면 refreshtoken을 쓰는건
로그아웃안하고 창을 닫거나
혹은 로그아웃안하고 계속사용하다 액세스토큰이 만료될때만 쓰는건가?
즉, 로그아웃을 하면 refresh token 왜 삭제해야하지?

#고민

